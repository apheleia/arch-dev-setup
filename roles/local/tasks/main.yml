---
- name: Install programs
  pacman: name="{{ item }}"
          state=present
  with_items:
    - firefox
    - nautilus
    - nautilus-actions
    - sushi
    - gcc
    - jdk8-openjdk
    - nginx
    - mariadb
    - mariadb-clients
    - mysql-workbench
    - nodejs
    - redis
    - php
    - php-fpm
    - php-pear
    - php-gd
    - php-intl
    - xdebug
  sudo: yes
  tags:
    - programs

- name: Initialize MariaDB
  command: mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
  sudo: yes
  tags:
    - programs

- name: Running services
  service: name="{{ item }}" state=started enabled=yes
  with_items:
    - mysqld
    - nginx
    - redis
    - php-fpm
  sudo: yes
  tags:
    - programs

- name: Secure MySQL
  debug: msg="You still need to secure mysql `mysql_secure_installation`!"
  tags:
    - programs

- name: Set PHP settings
  lineinfile: dest=/etc/php/php.ini
              regexp="^;?{{ item.key }}"
              line="{{ item.key }} = {{ item.value }}"
  with_items:
    - { key: "date.timezone", value: "Europe/Berlin" }
    - { key: "memory_limit", value: "1024M" }
    - { key: "upload_max_filesize", value: "30M" }
    - { key: "post_max_size", value: "30M" }
  sudo: yes
  tags:
    - programs

- name: Enable PHP modules
  lineinfile: dest=/etc/php/php.ini
              regexp="^;?extension={{ item }}.so"
              line="extension={{ item }}.so"
  with_items:
    - "mysql"
    - "mysqli"
    - "pdo_mysql"
    - "bcmath"
    - "soap"
  sudo: yes
  tags:
    - programs

- name: Create directory for AUR builds
  file: path=/home/{{ username }}/downloads/aur
        state=directory
  tags:
    - programs

- include: aur.yml
